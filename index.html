<!DOCTYPE html>
<html>
<head>
  <title>Bobblehead Motion Detector</title>
  <style>
    body { font-family: sans-serif; text-align: center; background: #f0f0f0; }
    video, canvas { display: block; margin: 0 auto; }
    h1 { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>Bobblehead Motion Detector</h1>
  <video id="video" width="320" height="240" autoplay muted playsinline></video>
  <canvas id="canvas" width="320" height="240" style="display: none;"></canvas>
  <p>Move the bobblehead to trigger a sound!</p>

  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let lastFrame = null;
    const audio = new Audio('digital.mp3'); // Your local MP3 file in the same repo

    navigator.mediaDevices.getUserMedia({ video: { facingMode: { exact: 'environment' } } }).then(stream => {
      video.srcObject = stream;
      requestAnimationFrame(detectMotion);
    }).catch(err => {
      console.error('Camera access error:', err);
    });

    function detectMotion() {
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      const currentFrame = ctx.getImageData(0, 0, canvas.width, canvas.height);

      if (lastFrame) {
        let diff = 0;
        for (let i = 0; i < currentFrame.data.length; i += 4) {
          const r = currentFrame.data[i];
          const g = currentFrame.data[i + 1];
          const b = currentFrame.data[i + 2];
          const gray = (r + g + b) / 3;

          const r2 = lastFrame.data[i];
          const g2 = lastFrame.data[i + 1];
          const b2 = lastFrame.data[i + 2];
          const gray2 = (r2 + g2 + b2) / 3;

          diff += Math.abs(gray - gray2);
        }

        if (diff > 1500000) { // threshold depends on lighting and size
          console.log('Motion detected');
          audio.play();
        }
      }

      lastFrame = currentFrame;
      requestAnimationFrame(detectMotion);
    }
  </script>
</body>
</html>
